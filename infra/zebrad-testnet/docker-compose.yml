# Zebra Testnet Infrastructure
# Usage:
#   docker-compose up -d          # Start Zebra testnet node
#   docker-compose logs -f        # Watch sync progress
#   docker-compose down           # Stop (keeps blockchain data)
#   docker-compose down -v        # Stop and delete blockchain data
#
# Once synced, Zebra RPC is available at localhost:18232

services:
  zebra:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: zebra-testnet
    ports:
      - "18232:18232"  # RPC port
      - "18233:18233"  # P2P port
    volumes:
      - zebra-testnet-data:/home/zebra/.cache/zebra
      - ./zebra-testnet.toml:/etc/zebrad/zebra.toml:ro
    healthcheck:
      test: ["CMD", "curl", "-sf", "-X", "POST", "-H", "Content-Type: application/json", "-d", "{\"jsonrpc\":\"2.0\",\"method\":\"getblockchaininfo\",\"params\":[],\"id\":1}", "http://localhost:18232"]
      interval: 30s
      timeout: 10s
      retries: 10
      start_period: 300s
    restart: unless-stopped

volumes:
  zebra-testnet-data:
